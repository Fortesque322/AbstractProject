unit Unit1;

interface

uses
  System.SysUtils;

type
  TModel = record
    FPrice : integer;
    FModel : string;
    FTotal :integer;
    function AsBytes : TBytes;
    procedure SetBytes(buf: TBytes);
  end;

  TMarket = class abstract
  private
    RecModel :TModel;
  protected
    procedure AddMotherboard(Price: integer; Model : string); virtual; abstract;
    procedure AddCPU(Price: integer; Model : string); virtual; abstract;
    procedure AddRAM(Price: integer; Model : string); virtual; abstract;
    procedure AddBody(Price: integer; Model : string); virtual; abstract;
    procedure AddPowerSupply(Price: integer; Model : string); virtual; abstract;
    procedure AddHdd(Price: integer; Model : string); virtual; abstract;
    procedure WriteToFile();
    procedure WriteToNoType();
  public
    procedure ReadFromFile();
    procedure ReadFromNoType();
    procedure assembly;
    constructor Create();
    Destructor Destroy();
  end;

  TAsus = class (TMarket)
    private
      procedure AddMotherboard(Price: integer; Model : string);override;
      procedure AddCPU(Price: integer; Model : string); override;
      procedure AddRAM(Price: integer; Model : string); override;
      procedure AddBody(Price: integer; Model : string); override;
      procedure AddPowerSupply(Price: integer; Model : string); override;
      procedure AddHdd(Price: integer; Model : string); override;
      procedure AddGraphicCard(Price: integer; Model : string);
  end;

  TZalman = class (TMarket)
    private
      procedure AddMotherboard(Price: integer; Model : string); override;
      procedure AddCPU(Price: integer; Model : string); override;
      procedure AddRAM(Price: integer; Model : string); override;
      procedure AddBody(Price: integer; Model : string); override;
      procedure AddPowerSupply(Price: integer; Model : string); override;
      procedure AddHdd(Price: integer; Model : string); override;
      procedure AddSsd(Price: integer; Model : string);
  end;

  THp = class (TMarket)
    private
      procedure AddMotherboard(Price: integer; Model : string);override;
      procedure AddCPU(Price: integer; Model : string); override;
      procedure AddRAM(Price: integer; Model : string); override;
      procedure AddBody(Price: integer; Model : string); override;
      procedure AddPowerSupply(Price: integer; Model : string); override;
      procedure AddHdd(Price: integer; Model : string); override;
      procedure AddSsd(Price: integer; Model : string);
      procedure AddGraphicCard(Price: integer; Model : string);
      procedure AddMonitor(Price: integer; Model : string);
  end;

implementation


{ TMarket }

procedure TMarket.assembly;
  var
    x: integer;
    y: string;
  begin
    writeln('Сборка: ');
    AddMotherboard(x,y);
    Writeln('Материнская плата: ' + RecModel.FModel);
    Writeln('Цена:' + IntToStr(RecModel.FPrice));
    WriteToFile;
    WriteToNoType;
    AddCPU(x,y);
    Writeln('Процессор: ' + RecModel.FModel);
    Writeln('Цена:' + IntToStr(RecModel.FPrice));
    WriteToFile;
    AddRAM(x,y);
    Writeln('Оперативная память: ' + RecModel.FModel);
    Writeln('Цена:' + IntToStr(RecModel.FPrice));
    WriteToFile;
    AddPowerSupply(x,y);
    Writeln('Блок Питания: ' + RecModel.FModel);
    Writeln('Цена:' + IntToStr(RecModel.FPrice));
    WriteToFile;
    AddHdd(x,y);
    Writeln('Жесткий диск: ' + RecModel.FModel);
    Writeln('Цена:' + IntToStr(RecModel.FPrice));
    WriteToFile;
    Writeln('-------------------------------------');
    Writeln('Итого: ' + IntToStr(RecModel.FTotal));
    Writeln('-------------------------------------');
  end;

constructor TMarket.Create;
begin

end;

destructor TMarket.Destroy;
begin

end;

procedure TMarket.ReadFromFile;
var
  TextRead : TextFile;
  i, sizeOfFile: integer;
  str: string;
begin
  AssignFile(TextRead,'C:\distr\TextFile.txt');
  Reset(TextRead);
  SizeOfFile := FileSize(TextRead);

  while not eof(TextRead) do
  begin
    Readln(TextRead, str);
    WriteLn(str);
  end;
  Close(TextRead)
end;

procedure TMarket.ReadFromNoType;
var
  NoTypeRead : file;
  Buf: TBytes;
  num: integer;
  begin
    AssignFile(NoTypeRead,'C:\distr\NoTypeFile');
    FileMode := fmOpenRead;
    Reset(NoTypeRead, 1);
    SetLength(Buf,FileSize(NoTypeRead));
    BlockRead(NoTypeRead,Buf[0],Length(Buf),num);
    CloseFile(NoTypeRead);
    Writeln(TEncoding.UTF8.GetString(Buf));
  end;


procedure TMarket.WriteToFile();
var
  TextRecord : TextFile;
begin
  AssignFile(TextRecord,'C:\distr\TextFile.txt');
  if Not FileExists('C:\distr\TextFile.txt') then
    begin
    Rewrite(TextRecord);
    end;
  Append(TextRecord);
  Writeln(TextRecord,RecModel.FModel);
  Writeln(TextRecord,RecModel.FPrice);
  Writeln(TextRecord,RecModel.FTotal);
  Close(TextRecord);
end;

procedure TMarket.WriteToNoType;
var
  NoType : File;
  Buf: array[1..255] of byte;
  num: integer;
  recSize: integer;
  fs: integer;
  sbuf: TBytes;
begin
  AssignFile(NoType,'C:\distr\NoTypeFile');
  if Not FileExists('C:\distr\NoTypeFile') then
    begin
    Rewrite(NoType,1);
    end;
  Reset(NoType,1);
  sbuf := RecModel;
  BlockWrite(NoType,sbuf[0],Length(sbuf));
  //BlockWrite(NoType,Buf,num);
  Close(NoType);
end;

{ TAsus }

procedure TAsus.AddBody(Price: integer; Model: string);
begin
  RecModel.FPrice := 3000;
  RecModel.FModel := 'InWin';
end;

procedure TAsus.AddCPU(Price: integer; Model: string);
begin
  RecModel.FPrice := 9000;
  RecModel.FModel := 'i5 - 3330';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TAsus.AddGraphicCard(Price: integer; Model: string);
begin
  RecModel.FPrice := 15000;
  RecModel.FModel := 'GTX 1050';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TAsus.AddHdd(Price: integer; Model: string);
begin
  RecModel.FPrice := 3000;
  RecModel.FModel := 'WD Blue ';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TAsus.AddMotherboard(Price: integer; Model: string);
begin
  RecModel.FPrice := 1000;
  RecModel.FModel := 'Asus H81 MK';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TAsus.AddPowerSupply(Price: integer; Model: string);
begin
  RecModel.FPrice := 3500;
  RecModel.FModel := 'PowerMan 500w';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TAsus.AddRAM(Price: integer; Model: string);
begin
  RecModel.FPrice := 6666;
  RecModel.FModel := 'Corsair 8GB';
  RecModel.FTotal := RecModel.FTotal + Price;
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

{ TZalman }

procedure TZalman.AddBody(Price: integer; Model: string);
begin
  RecModel.FPrice := 3500;
  RecModel.FModel := 'Zalman X55';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TZalman.AddCPU(Price: integer; Model: string);
begin
  RecModel.FPrice := 9999;
  RecModel.FModel := 'Ryzen 5 - 2700';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TZalman.AddHdd(Price: integer; Model: string);
begin
  RecModel.FPrice := 4500;
  RecModel.FModel := 'Segate Baracuda';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TZalman.AddMotherboard(Price: integer; Model: string);
begin
  RecModel.FPrice := 6890;
  RecModel.FModel := 'Gygabite Ax 570';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TZalman.AddPowerSupply(Price: integer; Model: string);
begin
  RecModel.FPrice := 4400;
  RecModel.FModel := 'CoolerMaste vx 650w';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TZalman.AddRAM(Price: integer; Model: string);
begin
  RecModel.FPrice := 5500;
  RecModel.FModel := 'Crucial 8GB';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

procedure TZalman.AddSsd(Price: integer; Model: string);
begin
  RecModel.FPrice := 5505;
  RecModel.FModel := 'Samsung EVO';
  RecModel.FTotal := RecModel.FPrice + RecModel.FTotal;
end;

{ THp }

procedure THp.AddBody(Price: integer; Model: string);
begin
  RecModel.FPrice := 5400;
  RecModel.FModel := 'HP ProDesk 600G4';
end;

procedure THp.AddCPU(Price: integer; Model: string);
begin
  RecModel.FPrice := 12000;
  RecModel.FModel := 'Ryzen 7 - 3900';
end;

procedure THp.AddGraphicCard(Price: integer; Model: string);
begin
  RecModel.FPrice := 23000;
  RecModel.FModel := 'RTX 2080';
end;

procedure THp.AddHdd(Price: integer; Model: string);
begin
  RecModel.FPrice := 5005;
  RecModel.FModel := 'FireCuda';
end;

procedure THp.AddMonitor(Price: integer; Model: string);
begin
  RecModel.FPrice := 10000;
  RecModel.FModel := 'VievSonic Va27';
end;

procedure THp.AddMotherboard(Price: integer; Model: string);
begin
  RecModel.FPrice := 7070;
  RecModel.FModel := 'Pegatron H280';
end;

procedure THp.AddPowerSupply(Price: integer; Model: string);
begin
  RecModel.FPrice := 8080;
  RecModel.FModel := 'HP 1000w';
end;

procedure THp.AddRAM(Price: integer; Model: string);
begin
  RecModel.FPrice := 6587;
  RecModel.FModel := 'Samsung 16GB';
end;

procedure THp.AddSsd(Price: integer; Model: string);
begin
  RecModel.FPrice := 25000;
  RecModel.FModel := 'Intel Inside';
end;

{ TModel }

function TModel.AsBytes: TBytes;
var
  Counter, size: integer;
begin
  SetLength(Result, SizeOf(FPrice) + Length(FModel) + SizeOf(FTotal));

  Counter := 0;

  Move(Fprice,Result[Counter],SizeOf(FPrice));
  inc(Counter,SizeOf(FPrice));

  size := Length(FModel);
  Move(size,Result[Counter],SizeOf(integer));
  inc(Counter,SizeOf(integer));

  Move(FModel[1],Result[Counter],Length(FModel));
  inc(Counter,Length(FModel));

  Move(FTotal,Result[Counter],SizeOf(FTotal));
end;

procedure TModel.SetBytes(buf: TBytes);
var
  Counter, size: integer;
begin
  Counter := 0;
  Move(buf[Counter],FPrice, SizeOF(FPrice));
  inc(Counter,SizeOf(FPrice));

  Move(buf[Counter],size, SizeOF(integer));
  inc(Counter,SizeOf(integer));

  SetLength(FModel, size);
  Move(buf[Counter],FModel[1], size);
  inc(Counter,SizeOf(integer));

  Move(buf[Counter],FTotal, SizeOF(FTotal));
end;

end.
